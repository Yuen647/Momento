![momento_cover](./assets/momento_cover.png)

# 项目提案：Momento（生活分享与社交互动平台）

**项目成员：**

2250286 李俊旻

2254272 赵子毅

2253551 李沅衡

[TOC]

## 1. 项目概述

### 1.1 背景

随着社交媒体和内容平台的迅速普及，用户愈发依赖在线平台来分享其生活、思想和经验，特别是在内容创作和兴趣社区互动领域，用户对个性化、实时性以及高可用性的需求持续上升。同时，随着用户基数的急剧增长，平台需要具备处理高并发读写请求的能力，以确保用户操作的实时响应和数据一致性。

### 1.2 动机

现有的内容分享和社交平台在应对高并发处理、个性化推荐、用户隐私保护和数据安全等方面存在显著不足。本项目通过采用先进的分布式架构和微服务设计，旨在解决这些局限性，为用户提供一个更稳定、高效且个性化的内容分享与社交互动平台。

### 1.3 项目目的与范围

本项目旨在构建一个内容分享与社交互动平台，支持用户发布笔记、点赞、收藏、关注等功能，满足用户对社交和内容分享的高标准需求。项目采用微服务架构，以应对海量用户的高并发需求，确保平台的高可用性和高扩展性。通过分布式架构实现数据一致性和实时响应，结合创新的社区互动方式，提升用户体验。项目的范围定义清晰，确保小组成员在开发过程中保持一致的理解，并明确项目的边界和交付物。

#### 1.3.1 项目目标

Momento 的核心目标是建立一个高效的内容分享平台，支持用户在海量内容中发布、互动和分享。该平台将通过高并发支持、数据一致性保障以及个性化推荐来提升用户体验，最终实现以下目标：

- 为用户提供便捷的笔记管理和互动功能，构建多层次的社交网络。
- 通过个性化推荐和搜索功能，提升用户的内容发现效率和粘性。
- 确保系统在高并发下的稳定性和数据的实时一致性。

#### 1.3.2 项目交付物

Momento 项目将交付以下主要功能模块，涵盖平台的核心功能需求：

- **笔记管理**：允许用户发布、编辑、删除笔记，支持设置笔记可见性（如公开、仅好友可见、私密），并提供笔记置顶、标签分类等功能。
- **用户互动**：支持用户对笔记进行点赞、评论和收藏操作。评论功能支持多层回复，增强用户互动体验。
- **用户关系**：实现用户的关注与取关操作，帮助用户建立社交网络，并提供关注者和粉丝列表的查看功能。
- **通知服务**：提供用户互动的实时通知（如点赞、评论、关注通知），确保用户可以及时掌握动态。
- **认证与授权**：支持用户注册、登录、密码管理和身份验证功能，使用 JWT 进行认证，并采用 RBAC 权限控制模型。
- **标签与话题**：用户可以为笔记添加标签，并参与话题讨论，促进社区的互动活跃性。
- **内容推荐**：基于用户的行为数据，使用机器学习算法提供个性化推荐，帮助用户发现感兴趣的内容。
- **搜索功能**：支持通过关键词、标签、用户和话题进行搜索，基于 Elasticsearch 提供高效的内容检索。
- **后台管理系统**：为管理员提供审查、管理用户内容、监控平台运行状态的工具，确保平台合规运营。
- **分布式存储与缓存**：采用 Redis、Minio 和 Cassandra 等技术，保障平台在高并发环境下的数据存储和高效缓存。

#### 1.3.3 项目边界

为了确保项目的聚焦性，Momento 平台的开发将专注于上述功能模块。以下内容不包括在项目范围内：

- 第三方社交平台的整合。
- 视频直播及其他媒体形式的支持。
- 电商、广告管理等业务扩展功能。

#### 1.3.4 项目约束与假设

- **约束条件**：平台需具备高可用性和数据一致性，在面对大量用户并发操作时，必须保持稳定。数据隐私和安全是项目的首要考虑，所有用户交互和数据存储必须符合相关的安全规范。
- **假设条件**：假设用户希望通过个性化推荐和实时通知功能提升平台的互动性，同时假设系统能够通过分布式架构有效应对高并发需求。

#### 1.3.5 验收标准

为了确保项目的成功交付，Momento 项目的验收标准包括：

- 系统核心功能能够在高并发场景下稳定运行。
- 数据一致性和用户操作的实时性达到预期，用户体验流畅。
- 系统功能齐全，后台管理系统能够有效管理用户和内容。
- 项目通过性能测试，并能够支持目标用户量级的使用需求。

#### 1.3.6 范围变更管理

任何范围变更必须通过小组讨论并获得批准后方可实施。项目的范围变更需要对项目时间表、资源分配及其他相关文档进行相应的更新，以确保变更对项目的影响最小化。

## 2. Main Functionalities

### 2.1 笔记与评论服务

- 用户可以发布、编辑、删除笔记，支持设置笔记的可见权限（公开、仅好友可见、私密）。

- 支持笔记置顶功能，便于用户展示重要内容。

- 评论服务支持嵌套评论与多层回复，用户可以通过评论与其他用户互动。

### 2.2 点赞与收藏服务

- 用户可以对笔记进行点赞、取消点赞，以及收藏笔记功能。

- 收藏功能支持分类管理，用户可以对收藏的笔记进行分类保存，方便管理收藏内容。

- 点赞、收藏操作会触发相关的通知与计数服务，确保用户的互动数据准确更新。

### 2.3 用户关系服务

- 实现用户之间的关注与取关操作，支持用户查看关注者与粉丝列表。

- 用户关系的变化将同步更新推荐服务，用于个性化推荐调整。

### 2.4 通知服务

- 向用户发送实时互动通知（如点赞、评论、关注），支持消息的实时推送与批量发送。

- 提供已读/未读状态管理，用户可以查看未读通知和历史通知记录。

### 2.5 认证服务

- 支持用户的注册、登录、密码修改功能，使用JWT进行身份验证。

- 提供多种登录方式（如手机号验证码登录、账号密码登录），并集成阿里云SMS服务发送验证码。

- 使用SaToken进行用户权限管理和角色控制（RBAC），支持用户的不同权限操作。

- 提供强密码管理、登录保护等安全功能，确保用户账户的安全性。

### 2.6 标签与话题服务

- 用户可以为笔记添加多个标签，帮助笔记分类，便于用户发现相关内容。

- 支持创建和参与话题讨论，平台可以展示热门话题，促进社区互动。

- 标签与话题服务支持与搜索功能集成，便于用户通过关键词查找笔记和话题内容。

### 2.7 内容推荐服务

- 基于用户的行为数据（浏览历史、点赞记录、收藏情况等），通过机器学习算法提供个性化推荐。

- 推荐服务与用户关系、点赞、收藏等操作数据联动，确保推荐内容的精准性和时效性。

### 2.8 搜索服务

- 用户可以通过关键词搜索笔记、用户、标签、话题，搜索服务基于Elasticsearch实现高效全文检索。

- 支持多条件组合搜索，如按照发布时间、点赞数等筛选笔记，便于用户精确查找感兴趣的内容。

- 为管理员提供内容审核的搜索支持，便于查找需要审核或屏蔽的笔记内容。

### 2.9 后台管理服务

- 管理员可以通过后台管理系统审核用户发布的笔记和评论内容，管理用户账户的权限。

- 提供数据统计功能，管理员可以查看平台的用户活跃度、互动量、内容发布数量等关键数据。

- 支持内容的分类审核与违规内容处理，确保平台内容的合法合规性。

### 2.10 分布式ID生成服务

- 整合美团Leaf分布式ID生成方案，提供高性能的号段ID和雪花算法ID生成，确保系统内所有操作的唯一性。

### 2.11 对象存储服务

- 负责存储用户上传的图片、视频等非结构化数据，支持Minio存储类型。

- 通过工厂模式和策略模式扩展存储类型，确保数据存储的灵活性。

- 结合Nacos进行分布式配置管理，动态注册存储策略，支持不同环境下的扩展性需求。

### 2.12 计数服务

- 统计用户的点赞数、收藏数、关注数、粉丝数等互动数据，确保在高并发场景下数据统计的准确性。

## 3. 初步逻辑架构

Momento平台基于微服务架构设计，利用Spring Cloud Alibaba生态系统进行服务治理、配置管理、限流熔断等功能的集成。各个服务之间通过REST API进行通信，确保高效的数据传输与操作的实时性。消息队列（RocketMQ）用于异步处理和解耦，确保高并发场景下的数据一致性与系统的高可用性。

### 3.1 总体逻辑架构图

![](./assets/diagram.png)

### 3.2 表现层

表现层负责与用户进行交互，主要包括：
- **Web 用户端**：基于 Vue 框架开发，提供桌面端用户界面，支持用户发布笔记、查看内容、互动等操作。
- **移动端（如果有）**：基于 uni-app 开发，提供移动端用户界面，确保用户能够方便地通过移动设备访问平台。

表现层通过 **Nginx** 反向代理服务器将用户请求分发至后端微服务，提供前后端解耦和负载均衡能力，保证用户请求的可靠分发和访问速度。

### 3.3 网关层

**服务网关层** 使用 **Spring Cloud Gateway** 作为微服务统一入口，具备以下功能：
- **请求路由与负载均衡**：将用户请求路由至对应的微服务，确保高效分发，同时支持请求的动态路由与灰度发布（灰度发布是一种逐步发布新版本的策略，通过将新版本的功能逐步开放给部分用户，从而降低系统的风险并进行稳定性测试）。
- **统一鉴权**：使用 **SaToken** 进行用户认证和授权，解析 Token 并将用户信息透传至下游服务，确保系统的安全性和用户操作的合法性。

### 3.4 业务逻辑层

业务逻辑层由多个微服务组件组成，通过 **Spring Cloud Alibaba** 进行管理，每个服务负责不同的业务逻辑，保证系统的松耦合和高扩展性，包括：

- **认证服务**：基于 RBAC（基于角色的访问控制）模型，支持用户登录认证（JWT）、注册、登出、密码修改等操作，确保用户身份的合法性。
- **用户服务**：管理用户信息，支持用户信息修改、查询和注册，采用 **Redis + Caffeine** 构建二级缓存，实现对用户信息的高并发访问。
- **笔记服务**：支持笔记的发布、编辑、查询、置顶、权限修改等功能，使用 **RocketMQ** 进行数据广播和缓存更新，保证数据一致性（RocketMQ 通过异步消息传递，实现数据在多个节点之间的一致更新，从而确保不同服务间的数据同步），并通过二级缓存实现笔记内容的高并发读操作。
- **用户关系服务**：管理用户之间的关注和取关操作，维护用户的社交关系链。利用 **Redis** 缓存和 **消息队列（MQ）** 实现高并发写入操作。
- **计数服务**：用于统计用户的关注数、粉丝数、点赞数等，通过消息队列消费用户行为数据，确保计数服务在高并发场景下的高性能和高可用性。消息队列通过异步处理用户行为数据，避免集中写入数据库的压力，从而提高系统的吞吐量。此外，消息队列的持久化和重试机制也保证了数据的可靠性，确保在高并发情况下服务的高可用性。
- **分布式 ID 生成服务**：基于 **美团 Leaf** 项目，为系统提供唯一标识符，支持高并发环境下的唯一 ID 生成，避免 ID 冲突。
- **对象存储服务**：存储平台的非结构化数据，如图片和视频。采用工厂模式和策略模式支持 **Minio** 存储类型，以便灵活扩展不同存储需求。
- **KV 短文本存储服务**：基于 **Apache Cassandra**，存储平台的短文本内容，如笔记正文和评论，支持高并发读写需求，确保数据的快速访问。

### 3.5 数据访问层

数据访问层由多种数据库和存储系统组成，以满足不同类型的数据需求，确保数据的安全性、持久性和高效访问：

- **MySQL**：用于存储关系型业务数据，提供事务性保障，确保数据的一致性和持久性。
- **Redis**：用于高频数据的缓存，显著提升系统的响应速度，降低数据库的压力。
- **Elasticsearch (ES)**：用于全文检索和高效数据查询，支持对笔记内容和用户数据的快速检索。
- **Apache Cassandra**：用于存储短文本数据，支持高并发读写需求，确保在大规模用户操作下的数据访问性能。
- **对象存储（Minio）**：用于存储图片、视频等非结构化数据，确保大规模文件存储的可靠性和可扩展性。

### 3.6 服务治理与中间件层

服务治理与中间件层负责服务的管理、监控和消息通信，采用以下工具来保障系统的高可用性和稳定性：

- **Nacos**：用于服务注册与配置管理，支持动态配置和服务发现，确保微服务的高可用性。
- **Sentinel**：用于流量控制和熔断限流，保护系统在高峰流量下的稳定性，防止过载。
- **RocketMQ**：用于异步消息传递，实现微服务之间的松耦合和高效通信，保证数据的一致性和实时性。
- **ZooKeeper**：用于分布式系统中的协调任务，保障分布式服务的一致性，管理分布式锁和配置。
- **XXL-JOB**：用于定时任务调度，支持分布式定时任务的执行和管理，确保任务的可靠执行。例如，定期清理无效数据、同步缓存和数据库的数据一致性、生成统计报表等。

### 3.6 基础设施与 DevOps 支持层

基础设施与 DevOps 支持层采用多种工具，以实现系统的自动化管理、持续集成和交付，提升系统的稳定性和开发效率：

- **Docker**：用于应用的容器化部署，确保微服务的可移植性和环境一致性，便于快速扩展和运维。

- **Git**：用于代码版本控制，管理代码变更，支持团队协作开发，确保代码的版本化和追溯性。

- **IntelliJ IDEA**：主要用于Java微服务的开发，提供强大的调试和代码分析功能。

- **Visual Studio Code**：用于前端开发和配置文件管理，轻量化且插件丰富。

- **Maven**：项目构建工具，管理依赖，编译打包应用。

## 4. 初步系统设计

### 4.1 用例图

#### 4.1.1 笔记功能用例设计

![](./assets/1.png)

#### 4.1.2 用户关系用例图

![2](./assets/2.png)

#### 4.1.3 个人信息管理用例图

![3](./assets/3.png)

![4](./assets/4.png)

### 4.2 活动图

#### 4.2.1 认证服务

负责认证服务的搭建与开发，基于RBAC模型，使用SaToken实现用户的JWT登录认证（支持账号登录、手机验证码登录）、登出、用户自注册、密码修改；对接阿里云SMS服务，自定义线程池异步发送手机号验证码，并实现短信接口防刷。

![](./assets/%E5%9B%BE%E7%89%871.png)



#### 4.2.2 用户服务

负责设计和实现用户服务，提供用户的基本信息管理，如用户信息修改、注册、查询、密码更新（BCrypt 随机 “盐” 加密）等；使用Redis + Caffeine本地缓存构建二级缓存，实现对外提供的接口，能够支持对用户信息查询的高并发读，能够有效防止缓存雪崩、缓存穿透、缓存击穿。 

![](./assets/%E5%9B%BE%E7%89%872.png)

#### 4.2.3 笔记服务

负责设计和实现笔记服务，支持用户进行笔记发布、编辑、查询、置顶、权限修改等功能。通过CompletableFuture并发调用下游服务，以降低接口响应耗时；并通过二级缓存， 支持笔记详情查询的高并发读；笔记更新、删除时，使用RocketMQ广播服务，实现集群环境下，对本地缓存中缓存的删除，达到数据一致性；点赞接口支持高并发写：使用Redis Bloom 布隆过滤器，高性能判断用户是否点赞，通过Redis ZSET + MQ异步落库，消费者中使用 RateLimiter令牌桶实现流量削峰，防止打垮数据库。

![](./assets/%E5%9B%BE%E7%89%873.png)

#### 4.2.4 用户关系服务

负责设计和实现用户关系服务。用户关注与取关：支持平台用户之间的关注、取关高并发写等社交操作，维护用户的社交关系链。通过Redis 缓存 + 发送顺序消息MQ异步存库，实现接口的高并发写与操作的顺序性，使用Lua脚本，避免频繁操作Redis造成的性能瓶颈，且保证多次操作的原子性；消费者使用联合唯一索引保证关系记录的幂等性；粉丝列表、关注列表查询：通过Redis ZSET数据结构，针对两种列表，分别使用不同的策略来缓存热点数据，以支持的高并发读分页查询请求。

![](./assets/%E5%9B%BE%E7%89%874.png)

## 5. 候选开发技术

- **编程语言**：  
  - **Java**：用于主业务逻辑的开发，结合Spring Boot框架，提供高效的服务端开发能力。  
- **微服务框架**：  
  - **Spring Cloud Alibaba**：提供一整套微服务解决方案，包括服务注册与发现、配置管理、限流熔断等。
  - **Nacos**：用于服务发现、配置管理以及动态DNS服务。
  - **Spring Cloud Gateway**：作为API网关，处理请求路由、负载均衡、限流、鉴权等操作。
  - **OpenFeign**：用于微服务之间的HTTP客户端调用，简化服务之间的通信。
- **数据库**：  
  - **MySQL**：用于关系型数据的持久化存储，适合业务数据（用户、笔记等）的存储。
  - **Redis**：作为分布式缓存系统，用于加速数据读取，缓解数据库压力，特别是在计数服务、热点数据等高并发场景下。
  - **Cassandra**：用于短文本数据存储，适合高写入、高读取的需求，确保数据在高并发下的高可用性。
  - **Elasticsearch**：作为全文搜索引擎，支持笔记、用户、话题等的检索，提供高效的查询能力。
- **消息队列**：  
  - **RocketMQ**：负责微服务之间的异步通信和事件驱动，支持高吞吐量的消息发布与订阅，确保系统的解耦和可靠性。
- **容器化**：  
  - **Docker**：对各个服务进行容器化部署，确保开发、测试与生产环境的一致性，方便快速部署与扩展。
  - **Kubernetes**：用于容器编排与管理，实现服务的自动化部署、扩展与管理，增强平台的高可用性。
- **对象存储**：  
  - **Minio**：作为轻量级分布式对象存储方案，支持存储平台上的图片、视频等非结构化数据，并且能与AWS S3 API兼容。
- **搜索引擎**：  
  - **Elasticsearch**：支持全文检索和高效的多维度查询，特别适合用于复杂搜索需求，如笔记、标签、话题等的检索。
- **分布式ID生成**：
  - **美团Leaf**：提供号段ID生成和雪花算法ID生成，保证系统中各项操作ID的全局唯一性和高性能。
- **认证与授权**：  
  - **SaToken**：支持基于JWT的轻量级认证与授权框架，提供多终端登录、权限控制、注解式鉴权等功能，确保系统的安全性。
- **开发工具与测试工具**：  
  - **IntelliJ IDEA**：主要用于Java微服务的开发，提供强大的调试和代码分析功能。
  - **Visual Studio Code**：用于前端开发和配置文件管理，轻量化且插件丰富。
  - **Git**：用于版本控制，支持分支管理与代码的协作开发。
  - **Maven**：项目构建工具，管理依赖，编译打包应用。
  - **Apifox**：用于API的接口测试、自动化测试与文档生成，方便开发过程中对接口进行校验和调试。

## 6. 中间件与平台

- **中间件**：  
  - **Nacos**：提供微服务的服务注册与发现，动态配置管理，确保服务的自动化管理与配置集中化。
  - **Sentinel**：提供限流、熔断和系统保护功能，确保系统在高并发下的稳定性和可用性。
  - **RocketMQ**：支持高并发、高吞吐量的消息发布订阅，主要用于解耦系统、异步处理任务和事件驱动架构。
  - **Zipkin**：用于分布式系统中的链路追踪，帮助监控微服务间的调用关系与性能瓶颈。
  - **Zookeeper**：作为分布式协调服务，提供分布式锁、Leader选举等功能，确保服务的一致性和协调管理。

- **平台**：  
  - **Kubernetes**：容器编排平台，管理容器的部署、扩展、负载均衡，确保服务的弹性扩展和自动化管理。
  - **Jenkins**：实现持续集成与持续部署（CI/CD），确保代码的自动化构建、测试与部署。
  - **Prometheus**：开源监控系统，用于收集服务的性能指标，监控服务的健康状况。
  - **Grafana**：与Prometheus结合，用于服务监控数据的可视化展示，帮助进行系统性能调优与故障排查。
  - **Docker Registry**：用于存储、分发Docker镜像，确保镜像版本管理和安全性。

## 7. 项目时间安排

- **第8-9周**：架构设计与技术方案验证，完成系统的微服务拆分，制定详细的开发任务
- **第10-13周**：核心功能开发，包括笔记、用户关系、点赞与收藏、标签与话题服务
- **第14-15周**：完成各个服务的集成，确保系统的可用性和正确性，开始进行系统集成测试
- **第16周**：系统测试与性能优化，处理并发问题和数据一致性，进行压力测试与性能调优
- **第17周**：准备演示材料和最终文档，完成项目的总结与汇报，进行项目验收

## 8. 项目亮点

通过Momento项目，我们致力于打造一个创新的内容分享与社交互动平台，以应对现有平台在高并发处理、个性化推荐、用户隐私保护等方面的挑战。Momento将以先进的微服务架构和分布式设计为基础，提供稳定、高效的社交体验，满足用户的个性化需求。该平台不仅关注社群互动和内容创作的便捷性，还特别注重高可用性与数据一致性，确保用户能够在任何时候享受到流畅的交互体验。

Momento的关键特性包括高扩展性、高可用性、灵活部署、数据一致性、以及个性化内容推荐。通过这些特性，我们为用户提供的不仅仅是一个社交平台，而是一个充满活力、紧密联系的兴趣社区。结合机器学习算法的推荐系统、灵活的标签与话题功能、以及创新的多级缓存架构，我们期望以更加智能的方式连接用户与内容。

我们的愿景是使Momento成为用户日常生活中不可或缺的一部分，让每一次分享与互动都充满价值和意义。

